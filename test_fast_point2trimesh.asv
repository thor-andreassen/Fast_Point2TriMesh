%% clear
clear
close all
clc

%% Load geometry
[men_geom]=stlread('meniscus_2.stl');
faces=men_geom.ConnectivityList;
nodes=men_geom.Points;
%% get face means and normals (STEP 1)
% do this once and store
[face_mean_nodes,face_normals]=getFaceCenterAndNormals(faces,nodes);

%% create KD tree (STEP 2)
% do this once and store
tree_model=KDTreeSearcher(face_mean_nodes);

%% create test points (these are the query or test points)
bb.min=min(nodes)-10;
bb.max=max(nodes)+10;
num_pts=10000;
pts=rand(num_pts,3).*(bb.max-bb.min)+bb.min;

%% plot test data
figure()
patch('Faces',faces,'Vertices',nodes,'FaceColor','r','FaceAlpha',.2,'EdgeAlpha',.1);

hold on
scatter3(pts(:,1),pts(:,2),pts(:,3),0.2,'bx');

%% determine distance and projection point (STEP 3)
tic
inputs.faces=faces;
inputs.nodes=nodes;
inputs.face_mean_nodes=face_mean_nodes;
inputs.face_normals=face_normals;
inputs.tree_model=tree_model;
[distances,project_pt,outside]=fastPoint2TriMesh(inputs,pts,1);
toc

%% plot test data
figure()
patch('Faces',faces,'Vertices',nodes,'FaceColor','r','FaceAlpha',.5,'EdgeAlpha',.8);

hold on

quiver(




legend({'Object','Internal Points','External Points'})
